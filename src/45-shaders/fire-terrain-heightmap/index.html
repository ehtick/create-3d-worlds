<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>CodePen - ThreeJS Height map vertex shader</title>
</head>

<body>

  <script id="vertex" type="shader">
  varying vec3 vNormal;
  varying vec3 light;
  
  uniform vec2 resolution;
  uniform float time;
  uniform float amplitude;
  uniform sampler2D heightMap;
  
  attribute float displacement;
  
  void main() {
    vec3 newPosition = position;
    float timeStep = time * 0.025;
    
    vec2 coords = vec2(uv);
    coords.y += timeStep;
    
    float uvScale = sin(timeStep) * 0.75;
    
    float redChannel = texture2D(heightMap, coords + uvScale + sin(time * 0.01)).r;
    newPosition.z = redChannel * displacement;
    vNormal = normal * newPosition;
    gl_Position = projectionMatrix * modelViewMatrix * vec4(newPosition, 1.0);
  }
</script>

  <script id="fragment" type="shader">
  varying vec3 vNormal;
  
  uniform float time;
  uniform vec2 resolution;
  uniform vec3 light;
  
  void main() {
    vec2 st = gl_FragCoord.xy / resolution.xy;
    vec3 color = vec3(1.0, 0.35, 0.0);
    vec3 newLight = normalize(light);
    float dotProduct = max(0.0, dot(vNormal, newLight));
    gl_FragColor = vec4(vec3(dotProduct) * color, 1.0);
  }
</script>

  <script src='https://cdnjs.cloudflare.com/ajax/libs/three.js/r71/three.min.js'></script>
  <script src="./script.js"></script>

</body>

</html>